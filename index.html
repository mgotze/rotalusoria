<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Roleta CMQ ‚Äì Ticks sincronizados</title>
<style>
  :root{
    --azul:#0072BC;
    --azul-bebe:#8DD0F7;
    --laranja:#F47A32;
    --laranja-fraco:#FF9559;
    --linha:#000;
    --aro:#1a1a1a;
    --radpx: 120px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:22px; background:linear-gradient(180deg,#f6f7fb,#eceff5);
    color:#111; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    display:flex; flex-direction:column; align-items:center; gap:18px;
  }
  .wrap{ position:relative; width:min(88vw,480px); aspect-ratio:1/1; }

  /* Ponteiro no topo apontando para BAIXO */
  .pointer {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 0; 
    height: 0; 
    border-left: 30px solid transparent;
    border-right: 30px solid transparent;
    border-top: 45px solid red;
    z-index: 10;
  }

  .wheel{
    width:100%; height:100%; border-radius:50%;
    background:
      repeating-conic-gradient(var(--linha) 0deg 1.2deg, transparent 1.2deg 72deg),
      conic-gradient(
        var(--azul)            0deg  72deg,
        var(--laranja)        72deg 144deg,
        var(--azul-bebe)     144deg 216deg,
        var(--laranja-fraco) 216deg 288deg,
        var(--azul)          288deg 360deg
      );
    position:relative; overflow:hidden;
    border:8px solid var(--aro);
    box-shadow: 0 10px 26px rgba(0,0,0,.25), inset 0 0 0 6px rgba(255,255,255,.2), inset 0 0 60px rgba(0,0,0,.15);
    /* Sem transition: o giro √© controlado por JS (rAF) para sincronizar os tics */
    will-change: transform;
    transform: rotate(0deg);
  }

  .labels{ position:absolute; inset:0; z-index:3; }
  .label{
    position:absolute; left:50%; top:50%; transform: translate(-50%,-50%);
    font-weight:900; font-size: clamp(36px, 9.5vw, 64px);
    text-shadow: 0 1px 2px rgba(0,0,0,.25);
  }
  /* 1 verde, 2 vermelho, 3 azul, 4 amarelo, 5 rosa */
  .l1{ transform: translate(-50%,-50%) rotate(36deg)  translateX(var(--radpx)) rotate(-36deg);  color:#3AA63A; } /* verde */
  .l2{ transform: translate(-50%,-50%) rotate(108deg) translateX(var(--radpx)) rotate(-108deg); color:#FF2D2D; } /* vermelho */
  .l3{ transform: translate(-50%,-50%) rotate(180deg) translateX(var(--radpx)) rotate(-180deg); color:#0072BC; } /* azul */
  .l4{ transform: translate(-50%,-50%) rotate(252deg) translateX(var(--radpx)) rotate(-252deg); color:#FFD700; } /* amarelo */
  .l5{ transform: translate(-50%,-50%) rotate(324deg) translateX(var(--radpx)) rotate(-324deg); color:#FF69B4; } /* rosa */

  .center{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:36%; aspect-ratio:1/1; border-radius:50%;
    background:#fff; border:4px solid rgba(0,0,0,.35);
    display:grid; place-items:center; z-index:4;
    box-shadow: 0 6px 16px rgba(0,0,0,.25);
    overflow:hidden;
  }
  .center img{ width:88%; height:auto; object-fit:contain; }

  .controls{ display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; }
  button{
    background: var(--azul); color:#fff; border:none; cursor:pointer;
    padding:12px 18px; border-radius:12px; font-size:16px; font-weight:800;
    box-shadow: 0 6px 16px rgba(0,0,0,.18);
  }
  button:disabled{ opacity:.6; cursor:not-allowed; }
</style>
</head>
<body>
  <div class="wrap">
    <div aria-hidden="true" class="pointer"></div>
    <div aria-label="Roleta 5 gomos" class="wheel" id="wheel" role="img">
      <div class="labels">
        <div class="label l1">1</div>
        <div class="label l2">2</div>
        <div class="label l3">3</div>
        <div class="label l4">4</div>
        <div class="label l5">5</div>
      </div>
      <div class="center"><img alt="Logo CMQ" src="./logo.jpg"/></div>
    </div>
  </div>

  <div class="controls">
    <button id="btn" type="button">üéØ GIRAR</button>
  </div>

  <!-- √Åudio: um √∫nico ‚Äútic‚Äù curtinho, repetido via JS -->
  <audio id="tick" src="./solotic.mp3" preload="auto"></audio>

<script>
/* ======= Setup de layout (posiciona n√∫meros no raio certo) ======= */
const wheel = document.getElementById('wheel');
function updateRadius(){
  const w = wheel.getBoundingClientRect().width;
  const rad = Math.round(w * 0.33);
  document.documentElement.style.setProperty('--radpx', rad + 'px');
}
updateRadius();
addEventListener('resize', updateRadius);

/* ======= Constantes e estado ======= */
const SEGMENT_DEG = 72;       // 360 / 5 gomos
const DEFAULT_DURATION = 3.4; // segundos
const MIN_SPINS = 3, MAX_SPINS = 5;

let currentAngle = 0;
let spinning = false;

/* ======= √Åudio: pool para evitar gargalo no play() ======= */
const tickEl = document.getElementById('tick');
const TICK_POOL_SIZE = 8;
let tickPool = null;
let poolIndex = 0;

function ensureTickPool(){
  if (tickPool) return;
  tickPool = Array.from({length: TICK_POOL_SIZE}, () => {
    const a = new Audio(tickEl.src);
    a.preload = 'auto';
    return a;
  });
}
function playTick(){
  if (!tickPool) return;
  const a = tickPool[poolIndex];
  poolIndex = (poolIndex + 1) % TICK_POOL_SIZE;
  try { a.currentTime = 0; a.play(); } catch(e){}
}

/* ======= Easing (desacelera√ß√£o suave) ======= */
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

/* ======= Sorteio do giro ======= */
function sorteiaDelta(){
  const voltas = (Math.floor(Math.random()*(MAX_SPINS - MIN_SPINS + 1)) + MIN_SPINS) * 360;
  const aleatorio = Math.random() * 360;
  return voltas + aleatorio;
}

/* ======= Anima√ß√£o com rAF + disparo de tick por gomo ======= */
function spin({duration = DEFAULT_DURATION} = {}){
  if (spinning) return;
  spinning = true;
  btn.disabled = true;

  const start = currentAngle;
  const delta = sorteiaDelta();
  const end   = start + delta;

  let startTs = null;
  let lastBoundary = Math.floor(start / SEGMENT_DEG);

  function frame(ts){
    if (!startTs) startTs = ts;
    const t = Math.min(1, (ts - startTs) / (duration * 1000));
    const p = easeOutCubic(t);

    const angle = start + delta * p;
    wheel.style.transform = `rotate(${angle}deg)`;

    // Detecta gomos cruzados desde o √∫ltimo frame (pode cruzar m√∫ltiplos no in√≠cio)
    const boundary = Math.floor(angle / SEGMENT_DEG);
    while (lastBoundary < boundary){
      lastBoundary++;
      playTick();
    }

    if (t < 1){
      requestAnimationFrame(frame);
    } else {
      currentAngle = end;
      spinning = false;
      btn.disabled = false;
    }
  }
  requestAnimationFrame(frame);
}

/* ======= Clique inicia o giro e inicializa pool de √°udio no gesto do usu√°rio ======= */
const btn = document.getElementById('btn');
btn.addEventListener('click', () => {
  // Em alguns navegadores m√≥veis, inicializar o √°udio precisa de gesto do usu√°rio
  ensureTickPool();
  spin({duration: DEFAULT_DURATION});
});
</script>
</body>
</html>
